<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@100..900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,400,0,0&family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@48,400,1,0" />


    <title>Quiz Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Press Start 2P';
        }

        body {
            background: #8B4513;
            min-height: 100vh;
        }

        nav {
            background-color: #421D06;
            padding: 0.3rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: white;
            padding-right: 20px;
            padding-left: 20px;
        }

        .hamburger-menu {
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            width: 22px;
            height: 18px;
            margin-bottom: 5px;
            padding-bottom: 1px;
        }

        .line {
            height: 3px;
            background-color: white;
        }

        .home-parent-con {
            padding-top: 2rem;
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            display: flex;
            justify-content: flex-end;
            margin-bottom: 1rem;
            position: relative;
            width: 100%;
        }

        .create-new-btn {
            width: 165px;
            height: 48px;
            background-color: #B56E4B;
            color: white;
            padding: 0.4rem 1rem;
            border-radius: 4px;
            cursor: pointer;
            font-size: 22px;
            border: 2px solid white;
            display: flex;
            justify-content: center;
            align-content: center;
            gap: 0.5rem;
            font-family: "VT323";
            box-shadow: 2px 2px 8px rgba(0, 0, 0, 0.3);
        }

        .create-icon {
            font-size: 22px;
            color: #74C857;
            border: 1px white;
            display: flex;
            justify-content: center;
            align-content: center;
            margin-top: 4px;

        }

        .title-cards {
            margin-top: 2rem;
            display: flex;
            flex-direction: column;
            gap: 1rem;
            align-items: center;
            justify-content: center;
            width: 100%;
        }

        .quiz-title-card {
            position: relative;
            background-color: #D4854C;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
            border: 5px solid #F7C396;
            width: 1206px;
            box-shadow: 2px 2px 8px rgba(0, 0, 0, 0.3);
        }

        h2 {
            padding-top: 0.5rem;
            color: white;
            font-size: 18px;
            margin-bottom: 1rem;
        }

        .card-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .score {
            color: white;
            font-size: 25px;
            font-family: 'VT323';
            padding-top: 1rem;
        }

        .score-value {
            color: #DD0D0D;
            font-family: 'VT323';
        }

        .score-max {
            color: #421D06;
            font-family: 'VT323';
        }

        .button-group {
            display: flex;
            gap: 0.5rem;
            font-family: 'VT323';
            padding-top: 1rem;
        }

        .item-button-group {
            position: absolute;
            /* Anchor to the parent */
            bottom: 1rem;
            /* Spacing from the bottom edge */
            right: 1rem;
            /* Spacing from the right edge */
            display: flex;
            gap: 0.5rem;
            font-family: 'VT323';
        }

        .play-btn,
        .summary-btn {
            width: 148px;
            height: 33px;
            border: none;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 4px;
            font-size: 21px;
            cursor: pointer;
            border: 2px solid white;
            text-align: center;
        }

        .play-btn {
            background-color: #26C236;
            color: white;
        }

        .summary-btn {
            background-color: #5D655E;
            color: white;
        }

        .settings-div {
            display: flex;
            flex-direction: column;
            gap: 10px;
            font-family: "VT323";
            font-size: 25px;
        }

        .settings-div button {
            padding: 10px;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: #8B4513;
            padding: 20px;
            border: 4px solid #F7C396;
            border-radius: 10px;
            width: 525px;
            height: 250px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .uploadmodal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: #8B4513;
            padding: 20px;
            border: 4px solid #F7C396;
            border-radius: 10px;
            width: 700px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .modal:target {
            display: block;
        }

        .close-btn {
            position: absolute;
            top: 15px;
            text-decoration: none;
            font-size: 24px;
            color: #fff;
            z-index: 10;
        }

        .add-btn {
            font-family: 'Outfit', sans-serif;
            background-color: #26C236;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 0.5rem 1rem;
            position: absolute;
            right: 4rem;
            /* Adjust as needed */
            top: 1rem;
            cursor: pointer;
            font-size: 16px;
            z-index: 10;
        }

        .check-btn {
            position: absolute;
            right: 20px;
            top: 15px;
            text-decoration: none;
            font-size: 24px;
            color: #fff;
            z-index: 10;
        }



        .input-field,
        .textarea-field {
            width: 100%;
            padding: 8px;
            margin: 10px 0;
            border: 4px solid #fff;
            border-radius: 4px;
            background-color: #D4854C;
            font-family: "Outfit";
            color: white;
        }

        .input-field::placeholder,
        .textarea-field::placeholder {
            color: white;
            font-family: "Outfit";
            font-size: 18px;
        }


        .upload-area {
            width: 375px;
            height: 300px;
            background-color: #D4854C;
            border: 4px dashed rgba(255, 255, 255, 0.45);
            ;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            position: relative;
            margin: 20px 0;
        }

        h5 {
            font-family: "VT323";
            font-size: 30px;
            color: white;
        }

        .radio-group {
            width: 650px;
            margin: 20px 0;
            border: 4px solid rgba(255, 255, 255, 0.45);
            ;
            border-radius: 10px;
            font-family: "Outfit";
        }

        .radio-group .radio-option {
            margin: 8px 2rem;
        }

        .radio-group .radio-option label {
            font-family: "Outfit";
            color: white;
        }

        .mult-option input {
            width: 50%;
            font-family: 'Outfit';
            font-size: 18px;
            color: white;
            margin: 0.5rem;
            border-radius: 2px;
            border: 2px solid white;
            background-color: #D4854C;
            padding-right: 4px;

        }

        .mult-option input::placeholder {
            color: white;
            padding-left: 4px;
            font-family: 'Outfit';
            font-size: 18px;
        }

        .button {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }


        .modal-footer {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 5px;
            text-align: center;
        }

        .cancel-btn {
            background-color: #f1f1f1;
            margin-right: 10px;
            font-family: "VT323";
            font-size: 20px;
            height: 40px;
            border: 2px solid white;
            justify-content: center;
            align-items: center;
            display: flex;
        }

        .create-btn {
            background-color: #26C236;
            color: white;
            font-family: "VT323";
            font-size: 20px;
            height: 40px;
            border: 2px solid white;
            justify-content: center;
            align-items: center;
            display: flex;
        }

        .settings-div {
            position: relative;
            z-index: 1050;
            margin: 0.5rem;
        }

        .manageAcc-modal {
            position: relative;
            width: 550px;
            height: 668px;
            background-color: #D4854C;
            border-radius: 10px;
            border: 5px solid #F7C396;
        }

        .manageAcc-modal .manageAcc-content {
            background-color: rgba(255, 229, 180, 0.3);
            width: 510px;
            border-radius: 5px;
        }

        .manageAcc-input {
            font-family: 'Outfit';
            font-size: 16px;
            border-radius: 5px;
            border: 2px solid #5D655E;
            width: 290px;
            height: 40px;
        }

        .save-btn {
            width: 100px;
            height: 40px;
            border: 2px solid white;
            border-radius: 5px;
            background-color: #26C236;
            color: white;
            font-family: "VT323";
            font-size: 22px;
            align-self: center;
            margin-top: 0.5rem;
        }

        .manage-account {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            /* Align items center horizontally */
            gap: 20px;
            margin-top: 1rem;
            /* Adjusted for better spacing */
        }

        .side-bar {
            position: fixed;
            background: #421D06;
            color: white;
            width: 375px;
            height: 100%;
            z-index: 1050;
        }

        .side-bar .sidebar-header {
            width: 100%;
            justify-content: left;
            display: flex;

        }

        .sidebar-overlay {
            display: none;
            /* Initially hidden */
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            /* Semi-transparent black */
            z-index: 1040;
            /* Below the sidebar */
        }

        .item-cards {
            display: flex;
            flex-direction: column;
            justify-content: center;
            /* Align items at the top */
            align-items: center;
            /* Prevent collapsing */
            width: 100%;
            /* Prevent overflow */
            gap: 1rem;
            /* Add spacing between items */
            z-index: 10;
            margin-top: 6rem;
            margin-bottom: 5rem;
        }

        .item-title-card {
            font-family: 'Outfit', sans-serif;
            background-color: #D4854C;
            border-radius: 8px;
            padding: 1rem;
            margin-top: 1rem;
            margin-bottom: 1rem;
            border: 5px solid #F7C396;
            width: 1206px;
            box-shadow: 2px 2px 8px rgba(0, 0, 0, 0.3);
            margin: auto;
            box-sizing: border-box;
            z-index: 10;
            position: relative;
            /* Add this */
        }


        .item-overlay {
            display: none;
            /* Initially hidden */
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            /* Semi-transparent black */
            z-index: 5;
            /* Below the sidebar */
            overflow-y: auto;
            height: 100vh;

        }

        .all-items {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            overflow-y: auto;

        }

        .quizcard-menu {
            position: absolute;
            top: 10px;
            right: 1rem;
            background: none;
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
        }

        .action-buttons {
            display: flex;
            position: absolute;
            gap: 10px;
            right: 0.8rem;
            top: 0.7rem;
        }

        .edit-btn,
        .delete-btn {
            background-color: transparent;
            padding: 8px;
            border: none;
            font-size: 18px;
            /* Icon size */
            color: white;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: background-color 0.3s ease, color 0.3s ease;
        }


        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-content {
            background: white;
            padding: 2em;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .loader {
            border: 5px solid #f3f3f3;
            border-radius: 50%;
            border-top: 5px solid #3498db;
            width: 40px;
            height: 40px;
            margin: 0 auto 1em;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }
    </style>
</head>

<body>
    <nav>
        <div class="menu-icon"><button style="background-color: #421D06; border: none; color: white;" type="button"
                onclick="toggleMenu()">
                <div class="hamburger-menu">
                    <div class="line"></div>
                    <div class="line"></div>
                    <div class="line"></div>
                </div>
            </button>
        </div>
        <div style="font-size: 20px;">
            <label for="" style="font-family: 'VT323'; font-size: 30px; margin-top: 2px;" id='welcome-msg'>Welcome!
                Katty</label>
        </div>
    </nav>


    <!-- Sidebar -->

    <div>
        <div class="modal side-bar" id="side-menu" tabindex="-1">
            <div class="sidebar-header">
                <div style="display: flex; justify-content: center; align-items: center; padding: 20px;">
                    <div style="border-radius: 50%; border: 2px solid white; padding: 8px; margin-right: 1rem;">
                        <i class="fa-solid fa-user"
                            style="margin-right: 4px; margin-left: 4px;font-size: 20px; color: white;"></i>
                    </div>
                    <h5 id='user-fullname'>Katty</h5>
                </div>

            </div>

            <div class="settings-div">
                <button onclick="openManageAcc()">Manage Account</button>
                <button onclick="openGameMechanics()">Game Mechanics</button>

                <button onclick="openSettingsModal()">Logout</button>

            </div>

        </div>
        <div class="sidebar-overlay" id="sidebar-overlay" type="button" onclick="closeSidebar()"></div>
    </div>


    <!-- Settings Modal -->
    <div id="settings-modal" class="modal settings-modal" tabindex="-1">
        <div class="modal-content"  style="background-color: #D4854C;">
            <a href="#" class="close-btn" style="left: 20px;" onclick="closeSettingsModal()">&times;</a>
            <h2 style="width: 100%; text-align: center; justify-content: center;">Confirm Logout</h2>
            <div>
                <label
                    style="font-family: 'Outfit'; color: white; font-size: 20px; justify-content: center; text-align: center; width: 100%; margin-top: 2rem; margin-bottom: 2rem;"
                    for="setting-option">Are you sure you want to logout?</label>
            </div>
            <div class="modal-footer">
                <button class="button create-btn" onclick="confLogout()">Yes, Logout Account</button>
                <button class="button cancel-btn" onclick="closeSettingsModal()">No, I'm Staying</button>
            </div>
        </div>
    </div>




    <div class="home-parent-con">



        <div class="header">

            <div class="search-bar-container"
                style="position: absolute; display: flex; align-items: center; left: 0rem; margin-top: 0.rem;">
                <input type="text" id="search-input" class="search-bar" placeholder="Search..." onkeyup="searchQuiz()"
                    style="padding: 8px; font-size: 20px; width: 300px; border: 1px solid #ccc; border-radius: 5px; font-family: 'VT323'; box-shadow: 2px 2px 8px rgba(0, 0, 0, 0.3);">
                <button onclick="searchQuiz()" class="search-button"
                    style="margin-left: 5px; background-color: #421D06; color: white; border: none; border-radius: 5px; padding: 8px;">
                    <i class="fa-solid fa-magnifying-glass" style="font-size: 20px;"></i>
                </button>
            </div>

            <button class="create-new-btn" onclick="showUploadModal()"><i
                    class="fa-solid fa-circle-plus create-icon"></i>Create New
            </button>
        </div>
        <!-- Start Game Button -->



        <!-- Create New Quiz -->
        <div id="upload-modal" class="modal modalSettings" style="display: none;">
            <div class="uploadmodal-content">

                <div id="loadingModal" class="modal-overlay" style="display: none;">
                    <div class="modal-content">
                        <div class="loader"></div>
                        <p>Generating questions...</p>
                    </div>
                </div>

                <h2 style="color: white; width: 100%; justify-content: center; text-align: center;">Create New</h2>

                <input id="title" type="text" class="input-field" placeholder="Add Title">
                <textarea id="description" rows="4" cols="70" class="textarea-field"
                    placeholder="Add Description Optional"></textarea>

                <div class="radio-group">
                    <p style="font-family: 'Outfit'; margin: 0.5rem 0.5rem; color: white; font-size: 18px;">Choose the
                        type of question:</p>
                    <div style="display: flex; gap: 10px; font-size: 16px;">
                        <div class="radio-option">
                            <input type="checkbox" id="true-false" name="question-type" value="truefalse">
                            <label for="true-false">True or False</label>
                        </div>
                        <div class="radio-option">
                            <input type="checkbox" id="identification" name="question-type" value="identification">
                            <label for="identification">Identification</label>
                        </div>
                        <div class="radio-option">
                            <input type="checkbox" id="multiple-choice" name="question-type" value="multchoice">
                            <label for="multiple-choice">Multiple Choice</label>
                        </div>
                    </div>
                </div>

                <input id="itemnum" type="number" class="input-field" placeholder="Number of Items" min="1" step="1">

                <div class="modal-footer">
                    <button class="button cancel-btn" onclick="closeCreateNew()">Cancel</button>
                    <button class="button create-btn" id="add-quiz-items">Create Quiz</button>
                </div>
            </div>

        </div>
    </div>

    <!-- edit quiz -->
    <div id="edit-quiz-modal" class="modal modalSettings" style="display: none;">
        <div class="uploadmodal-content" style="height: 360px;">

            <h2 style="color: white; width: 100%; justify-content: center; text-align: center;">Edit Quiz</h2>

            <input id="edit-title" type="text" class="input-field" placeholder="Add Title">
            <textarea id="edit-description" rows="4" cols="70" class="textarea-field"
                placeholder="Add Description Optional"></textarea>
            <div class="modal-footer">
                <button class="button cancel-btn" onclick="closeEditQuiz()">Cancel</button>
                <button class="button create-btn" onclick="saveQuizUpdate()">Save</button>
            </div>
        </div>

    </div>
    </div>

    <!-- View Quiz Title Cards -->
    <div class="title-cards" id="title-cards">
    </div>

    <div id="all-items" class="all-items" style="display: none;">
        <div class="item-cards" id="item-cards">
            <a href="#" class="close-btn" onclick="closeItems()">&times;</a>
            <div class="item-title-card" id="item-title-card">
                <p style="font-family: 'Outfit'; font-size: 20px; color: white;">Question Identfication</p>
                <div class="card-content">
                    <div class="">
                        <p style="font-family: 'Outfit'; font-size: 18px; color: #006600;">Answer: </p>
                    </div>
                </div>
            </div>
        </div>
        <div class="item-overlay" id="item-overlay"></div>
    </div>



    <!-- Manage Account -->
    <div class="modal manage-account" id="manageAccount" tabindex="-1" style="display: none;">

        <div class="manageAcc-modal">
            <a href="#" class="close-btn" style="left:20px;" onclick="closeManageAcc()">&times;</a>
            <h2
                style="margin-bottom: 1rem; margin-top: 2rem; justify-content: center; width: 100%; text-align: center;">
                Manage Account</h2>
            <div
                style="display: flex; flex-direction: column; justify-content: center; align-items: center; gap: 20px;">
                <div class="manageAcc-content">
                    <h4
                        style="font-family: 'VT323'; font-size: 29px; color: white; width: 100%; text-align: center; margin-top: 0.5rem;">
                        Profile</h4>
                    <div class="profile-content"
                        style="display: flex; flex-direction: column; gap: 1rem; margin: 0.5rem;">
                        <div>
                            <label
                                style="font-family: 'Outfit'; font-size: 19px; color: white; margin-left: 2rem; width: 7.2rem; justify-content: left;">Firstname</label>
                            <input type="text" class="manageAcc-input" style="padding-left: 5px;" id='manage-firstname'>
                        </div>
                        <div>
                            <label
                                style="font-family: 'Outfit'; font-size: 19px; color: white; margin-left: 2rem;  width: 7.2rem; justify-content: left;"">Lastname</label>
                    <input type=" text" class="manageAcc-input" style="padding-left: 5px;" id='manage-lastname'>
                        </div>
                        <div>
                            <label
                                style="font-family: 'Outfit'; font-size: 19px; color: white; margin-left: 2rem;">Security
                                Code</label>
                            <input type="text" class="manageAcc-input" style="padding-left: 5px;" id='manage-security'>
                        </div>
                        <div style="width: 100%; justify-content: center; text-align: center;">
                            <button class="save-btn" onclick="saveProfile()">Save</button>
                        </div>
                    </div>

                </div>

                <div class="manageAcc-content" style="height: 270px;">
                    <h4
                        style="font-family: 'VT323'; font-size: 29px; color: white; width: 100%; text-align: center; margin-top: 0.5rem;">
                        Change Password </h4>
                    <div class="profile-content"
                        style="display: flex; flex-direction: column; gap: 1rem; margin: 0.5rem;">
                        <div>
                            <label
                                style="font-family: 'Outfit'; font-size: 16px; color: white; margin-left: 2rem; width: 8.1rem;">Current
                                Password</label>
                            <input type="password" class="manageAcc-input" style="padding-left: 5px;"
                                id='manage-currpass'>
                        </div>
                        <div>
                            <label
                                style="font-family: 'Outfit'; font-size: 16px; color: white; margin-left: 2rem; width: 8.1rem;">New
                                Password</label>
                            <input type="password" class="manageAcc-input" style="padding-left: 5px;"
                                id='manage-newpass'>
                        </div>
                        <div>
                            <label
                                style="font-family: 'Outfit'; font-size: 16px; color: white; margin-left: 2rem;">Confirm
                                Password</label>
                            <input type="password" class="manageAcc-input" style="padding-left: 5px;"
                                id='manage-confpass'>
                        </div>
                    </div>
                    <div style="width: 100%; justify-content: center; text-align: center;">
                        <button class="save-btn" onclick="savePassword()">Save</button>
                    </div>
                </div>
            </div>

        </div>
    </div>



    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>
    <script src="https://kit.fontawesome.com/88979c2f8f.js" crossorigin="anonymous"></script>
    <!-- Bootstrap JS (required for Offcanvas) -->

    <script type="module">


        import { app, db, ref, set, get, child, getDatabase, onValue, update, remove, push, } from './firebaseCOnnection/firebaseCon.js';
        // API Setup
        const API_KEY = "AIzaSyCevvOofrLgFPPcFgvuHqn6xZ4cibfgSlU";
        const API_URL = `https://generativelanguage.googleapis.com/v1/models/gemini-1.5-pro:generateContent?key=${API_KEY}`;

        //global variables
        let currentQuizId = null
        let quizdetails = {}
        let bestscore = 0
        let quizItems = []
        let currentItemId = null
        let currentItemType = null

        // for home display
        const username = sessionStorage.getItem('username');
        const firstname = sessionStorage.getItem('firstname');
        const lastname = sessionStorage.getItem('lastname');

        if (username) {
            document.getElementById('welcome-msg').textContent = `Welcome, ${firstname}!`;
            document.getElementById('user-fullname').textContent = `${firstname} ${lastname}`;
        }



        window.getUserQuizzes = async function () {
            const dbRef = ref(getDatabase());

            try {
                // Access the "user/{username}/quizzes" node
                const snapshot = await get(child(dbRef, `user/${username}/quizzes`));

                if (snapshot.exists()) {
                    // Return the quizzes data
                    const quizzes = snapshot.val();
                    const quizContainer = document.getElementById('title-cards');

                    // Clear the existing quiz cards in case any exist
                    quizContainer.innerHTML = '';

                    // Loop through each quiz and generate a quiz card
                    Object.keys(quizzes).forEach(quizId => {
                        const quiz = quizzes[quizId];
                        // Create a new div for the quiz card
                        const quizCard = document.createElement('div');
                        quizCard.classList.add('quiz-title-card');
                        quizCard.setAttribute('data-title', quiz.title);
                        quizCard.setAttribute('data-description', quiz.description);

                        // Set the inner HTML for the quiz card
                        quizCard.innerHTML = `
                <div class="action-buttons">
                    <button class="edit-btn" onclick  ="editQuiz('${quizId}')"><i class="fa fa-pencil"></i> </button>
                    <button class="delete-btn" onclick = "deleteQuiz('${quizId}')"><i class="fa fa-times"></i></button>
                </div>
                    <h2>${quiz.title}</h2>
                    <p style = "font-family: 'Outfit'; font-size: 16px; color: white;">Description: ${quiz.description}</p>
                    <div class="card-content">
                        <div class="score">
                            Best Score: <span class="score-value" style="color:#2130B6;">${quiz.bestscore || 0}</span><span class="score-max">/${quiz.maxscore}</span>
                        </div>
                        <div class="button-group">
                <button class="play-btn" onclick="playGame('${quizId}', ${quiz.bestscore})">Play</button>
                            <button class="summary-btn" onclick = showItems('${quizId}')>View Items</button>
                        </div>
                    </div>

                    
                
                `;

                        quizContainer.appendChild(quizCard);
                    });
                } else {
                    console.log(`No quizzes found for username: ${username}`);
                    document.getElementById('title-cards').textContent = 'No quizzes yet.'
                    document.getElementById('title-cards').style.color = 'white';

                }
            } catch (error) {
                console.error("Error fetching quizzes:", error);
                throw error;
            }
        }

        getUserQuizzes()

        // Search Bar
        window.searchQuiz = function () {
            const searchInput = document.getElementById("search-input");
            const query = searchInput.value.trim().toLowerCase(); // Trim and convert input to lowercase
            const quizCards = document.querySelectorAll(".quiz-title-card");
            let hasMatch = false; // Flag to track if any card matches

            if (query) {
                quizCards.forEach(card => {
                    const title = card.getAttribute("data-title").toLowerCase();
                    const description = card.getAttribute("data-description").toLowerCase(); // Search in description too

                    if (title.includes(query) || description.includes(query)) {
                        card.style.display = "block";
                        hasMatch = true;
                    } else {
                        card.style.display = "none";
                    }
                });

                if (!hasMatch) {
                    const noMatchMessage = document.getElementById("no-match-message");
                    if (!noMatchMessage) {
                        const message = document.createElement("p");
                        message.id = "no-match-message";
                        message.textContent = "No match found.";
                        message.style.color = "white";
                        message.style.textAlign = "center";
                        document.getElementById("title-cards").appendChild(message);
                    }
                } else {
                    const noMatchMessage = document.getElementById("no-match-message");
                    if (noMatchMessage) {
                        noMatchMessage.remove();
                    }
                }
            } else {
                quizCards.forEach(card => {
                    card.style.display = "block";
                });
                const noMatchMessage = document.getElementById("no-match-message");
                if (noMatchMessage) {
                    noMatchMessage.remove();
                }
            }
        };


        // SETTINGS
        window.openSettingsModal = function () {
            document.getElementById('settings-modal').style.display = 'block';
            document.getElementById('side-menu').style.display = 'none';
            document.getElementById('sidebar-overlay').style.display = 'none';
        }

        window.closeSettingsModal = function () {
            document.getElementById('settings-modal').style.display = 'none';
        }

        window.openManageAcc = function () {

            const userRef = ref(db, 'user/' + username);
            get(userRef).then((snapshot) => {
                if (snapshot.exists()) {
                    const users = snapshot.val();

                    document.getElementById('manage-firstname').value = users.firstname
                    document.getElementById('manage-lastname').value = users.lastname
                    document.getElementById('manage-security').value = users.security
                }
            })

            document.getElementById('manageAccount').style.display = 'flex';
            document.getElementById('side-menu').style.display = 'none';
            document.getElementById('sidebar-overlay').style.display = 'none';
        }

        window.saveProfile = function () {
            var managefname = document.getElementById('manage-firstname').value
            var managelname = document.getElementById('manage-lastname').value
            var managesecurity = document.getElementById('manage-security').value

            if (!managefname || !managelname || !managesecurity) {
                alert("Please fill in all the fields.")
                return;
            }

            const userRef = ref(db, 'user/' + username);
            update(ref(db, 'user/' + username), {
                firstname: managefname,
                lastname: managelname,
                security: managesecurity
            });
            alert("Changes Saved!")

            document.getElementById('welcome-msg').textContent = `Welcome, ${managefname}!`;
            document.getElementById('user-fullname').textContent = `${managefname} ${managelname}`;
            sessionStorage.setItem('firstname', managefname);
            sessionStorage.setItem('lastname', managelname);

        }

        window.savePassword = function () {
            var managecurrpass = document.getElementById('manage-currpass').value
            var managenewpass = document.getElementById('manage-newpass').value
            var manageconfpass = document.getElementById('manage-confpass').value

            if (!managecurrpass || !managenewpass || !manageconfpass) {
                alert("Please fill in the password fields.")
                return;
            }
            else if (managenewpass != manageconfpass) {
                alert("Passwords do not match, please try again.")
                return;
            }
            else {

                const userRef = ref(db, 'user/' + username);
                get(userRef).then((snapshot) => {
                    if (snapshot.exists()) {
                        const users = snapshot.val();

                        if (users.password != managecurrpass) {
                            alert("Current password is incorrect, please try again.")
                            return;
                        }
                        else {
                            update(ref(db, 'user/' + username), {
                                password: managenewpass
                            });
                            alert("Password Updated!")
                            location.reload()
                        }
                    }
                })
            }
        }

        window.closeManageAcc = function () {
            document.getElementById('manage-newpass').value = ''
            document.getElementById('manage-confpass').value = ''
            document.getElementById('manage-currpass').value = ''
            document.getElementById('manageAccount').style.display = 'none';

        }

        window.toggleMenu = function () {
            document.getElementById('side-menu').style.display = 'block';
            document.getElementById('sidebar-overlay').style.display = 'block';
        };



        window.closeSidebar = function () {
            document.getElementById('sidebar-overlay').style.display = 'none';
            document.getElementById('side-menu').style.display = 'none';

        }

        window.showUploadModal = function () {
            console.log('Upload modal')
            document.getElementById('upload-modal').style.display = 'block';
        }


        window.addQuizItems = function () {
            document.getElementById('add-item').style.display = 'block';
            document.getElementById('upload-modal').style.display = 'none';
        }

        window.closeCreateNew = function () {
            document.getElementById('upload-modal').style.display = 'none';
            resetFields()
        }

        window.cancelCreateNew = function () {
            const confirmCancel = window.confirm("Are you sure you want to exit? Quiz will not be saved.")
            if (confirmCancel) {
                document.getElementById('add-item').style.display = 'none';
                resetFields()
            }
        }

        window.showmultiplechoice = function () {
            hideQuestionModals()
            document.getElementById('multiple-choice-modal').style.display = 'block';
        }

        window.showidentification = function () {
            hideQuestionModals()
            document.getElementById('identification-modal').style.display = 'block';
        }

        window.showtruefalse = function () {
            hideQuestionModals()
            document.getElementById('true-false-modal').style.display = 'block';
        }

        window.hideQuestionModals = function () {
            document.getElementById('identification-modal').style.display = 'none';
            document.getElementById('true-false-modal').style.display = 'none';
            document.getElementById('multiple-choice-modal').style.display = 'none';
        }


        // Function to show loading modal
        function showLoading() {
            document.getElementById('loadingModal').style.display = 'flex';
        }

        // Function to hide loading modal
        function hideLoading() {
            document.getElementById('loadingModal').style.display = 'none';
        }


        // ------------------------ QUESTION GENERATOR-----------------------------------
        document.getElementById('add-quiz-items').addEventListener('click', async function (e) {
            e.preventDefault();

            let title = document.getElementById('title').value;
            let description = document.getElementById('description').value;
            let itemnum = parseInt(document.getElementById('itemnum').value);

            // Input validation
            const checkboxes = document.querySelectorAll('input[name="question-type"]:checked');
            let selectedValues = Array.from(checkboxes).map(checkbox => checkbox.value);

            if (!title) {
                alert('Please add a title.');
                return;
            } else if (selectedValues.length === 0) {
                alert("Please select at least one question type.");
                return;
            } else if (itemnum < 3 || !itemnum) {
                alert("Number of items should be at least 3.");
                return;
            }


            // Show loading modal before starting the API call
            showLoading();

            try {
                // ------------------------GENERATE QUESTION------------------------------
                let userMessage = `Generate ${itemnum} quiz questions about "${title}". 
            Question types to include: ${selectedValues.join(", ")}.
            Provide correct answers for each question.`;

                if (selectedValues.includes("multchoice")) {
                    userMessage += ` For multiple choice questions, limit the options to only 3, including the correct answer.`;
                }

                try {
                    const response = await fetch(API_URL, {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json"
                        },
                        body: JSON.stringify({
                            contents: [{
                                parts: [{
                                    text: userMessage
                                }]
                            }]
                        })
                    });

                    const data = await response.json();

                    if (!response.ok) {
                        throw new Error(data.error.message || 'Failed to generate quiz items');
                    }

                    let quizContent = data.candidates[0].content.parts[0].text;
                    // console.log(quizContent)

                    //----------------------------FORMAT THE GENERATED QUESTIONS------------------
                    let formatPrompt = `Reformat the following quiz questions into the following format:
                1. [Question] [Correct Answer]
                (For multiple-choice questions, list the options below the question, and then provide the correct option letter on a new line. The correct option letter should appear after all options, without any additional text or explanation.)

                Example format:
                1. Zero is a positive integer. True or False? 
                Correct: False
                2. What is the name of the mathematical operation that involves repeated addition? 
                Correct: Multiplication
                3. Which of the following is an example of a prime number?
                    a) 10  
                    b) 15  
                    c) 17  
                Correct: c
                5. A number is divisible by 3 if the sum of its digits is divisible by 3. True or False? 
                Correct: True

                Now format the following quiz questions:
                \n${quizContent}`;

                    const formatResponse = await fetch(API_URL, {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json"
                        },
                        body: JSON.stringify({
                            contents: [{
                                parts: [{ text: formatPrompt }]
                            }]
                        })
                    });

                    const formattedData = await formatResponse.json();

                    if (!formatResponse.ok) {
                        throw new Error(formattedData.error.message || 'Failed to format quiz items');
                    }

                    let formattedQuizContent = formattedData.candidates[0].content.parts[0].text;
                    formatQuestion(itemnum, title, description, formattedQuizContent)

                } catch (error) {
                    console.error("Error generating quiz items:", error);
                }

            } catch (error) {
                console.error("Error generating quiz items:", error);
                alert("An error occurred while generating questions. Please try again.");
            } finally {
                // Hide loading modal regardless of success or failure
                hideLoading();
            }
        });

        // ------------------------QUESTION FORMATTER------------------
        window.formatQuestion = function (itemnum, title, description, formattedQuizContent) {

            console.log(formattedQuizContent)
            let quizArray = [];
            let lines = formattedQuizContent.split("\n");
            let currentQuestion = "";
            let currentAnswer = "";

            for (let i = 0; i < lines.length; i++) {
                let line = lines[i].trim();

                if (line.match(/^\d+\./)) {
                    // New question detected, push the previous one if it exists
                    if (currentQuestion && currentAnswer) {
                        quizArray.push([currentQuestion, currentAnswer]);
                    }
                    currentQuestion = line.replace(/^\d+\.\s*/, ""); // Remove question number
                    currentAnswer = "";
                } else if (line.startsWith("Correct:")) {
                    currentAnswer = line.replace("Correct: ", "").trim();
                } else if (line.match(/^[a-c]\)/)) {
                    // It's a multiple-choice option, append to the current question
                    currentQuestion += `\n${line}`;
                }
            }

            // Push the last question-answer pair
            if (currentQuestion && currentAnswer) {
                quizArray.push([currentQuestion, currentAnswer]);
            }

            console.log(quizArray);
            insertintoDB(itemnum, title.toUpperCase(), description, quizArray)
        }


        // ---------------------------INSERTING QUESTIONS IN THE DATABASE------------------------
        window.insertintoDB = async function (itemnum, title, description, quizArray) {
            try {
                // Firebase database reference (modify as needed)
                const quizRef = ref(db, `user/${username}/quizzes`);
                const newQuizRef = push(quizRef); // Generates a new unique quiz entry

                // Prepare the quiz object
                const quizData = {
                    bestscore: bestscore, // Default best score
                    maxscore: itemnum, // Total number of quiz items
                    title: title,
                    description: description,
                    quizitems: quizArray.map((item, index) => ({
                        itemId: index + 1,
                        question: item[0],
                        answer: item[1]
                    }))
                };

                // Insert data into Firebase
                await set(newQuizRef, quizData);

                alert("Quiz created!");
                console.log("Quiz successfully created!");
                location.reload()
                resetFields()
                document.getElementById('add-item').style.display = 'none';
                showItems(quizId);

            } catch (error) {
                console.error("Error inserting quiz into Firebase:", error);
            }
        }

        // prevents to add decimal and characters for the number of items field
        document.getElementById('itemnum').addEventListener('keypress', function (event) {
            // Prevent decimal point, comma, minus sign, or anything non-numeric
            if (event.key === '.' || event.key === ',' || event.key === '-') {
                event.preventDefault();
            }
        });

        window.resetFields = function () {
            quizItems = [];
            quizdetails = {};
            bestscore = 0;
            document.getElementById('title').value = '';
            document.getElementById('description').value = '';
            document.getElementById('itemnum').value = '';
            document.querySelectorAll('input[name="question-type"]').forEach(checkbox => {
                checkbox.checked = false;
            });
        }


        window.hideAddOneModals = function () {
            document.getElementById('addOneTrueFalse').style.display = 'none';
            document.getElementById('addOneMultChoice').style.display = 'none';
            document.getElementById('addOneIdentification').style.display = 'none';
        }

        window.showItems = async function (quiz_id) {
            currentQuizId = quiz_id;
            document.getElementById('all-items').style.display = 'block';
            document.getElementById('item-overlay').style.display = 'block';
            document.getElementById('item-cards').style.display = 'flex';
            document.getElementById('item-cards').scrollTop = 0;
            const dbRef = ref(getDatabase());

            try {
                // Fetch quiz items using quiz_id
                const snapshot = await get(child(dbRef, `user/${username}/quizzes/${quiz_id}/quizitems`));

                const itemContainer = document.getElementById('item-cards');

                // Clear the overlay content before updating
                itemContainer.innerHTML = '';

                // Create and append "No items found" message if there are no items
                const noItemsMessage = document.createElement('div');
                noItemsMessage.id = 'no-items-message';
                noItemsMessage.style.fontSize = '18px';
                noItemsMessage.style.color = '#fff';
                noItemsMessage.style.textAlign = 'center';
                noItemsMessage.style.marginTop = '2rem';
                noItemsMessage.textContent = 'No items found for this quiz.';

                // Close button
                const closeButton = document.createElement('a');
                closeButton.href = "#";
                closeButton.className = "close-btn";
                closeButton.innerHTML = "&times;";
                closeButton.onclick = closeItems;
                closeButton.style.right = "1rem";
                itemContainer.appendChild(closeButton);

                // Fetch items from snapshot
                if (snapshot.exists()) {
                    const items = snapshot.val();

                    // Loop through each item and generate a card
                    Object.keys(items).forEach(itemId => {
                        const item = items[itemId];

                        // Ensure newlines are displayed properly
                        const formattedQuestion = item.question.replace(/\n/g, "<br>");

                        // Create a new div for the item card
                        const itemCard = document.createElement('div');
                        itemCard.classList.add('item-title-card');

                        itemCard.innerHTML = `
                            <p style="font-family: 'Outfit'; font-size: 20px; color: white;">${formattedQuestion}</p>
                            <div class="card-content">
                                <div class="">
                                    <p style="font-family: 'Outfit'; font-size: 18px; color: #006600;">Answer: ${item.answer}</p>
                                </div>
                            </div>
                        `;

                        itemContainer.appendChild(itemCard);
                    });
                } else {
                    // If no items exist, show the "No items found" message
                    itemContainer.appendChild(noItemsMessage);
                }
            } catch (error) {
                console.error("Error fetching quiz items:", error);
            }
        };


        window.closeItems = function () {
            document.getElementById('all-items').style.display = 'none';
            document.getElementById('item-overlay').style.display = 'none'
            document.getElementById('item-cards').style.display = 'none';
        }

        window.confLogout = function () {
            window.location.href = 'index.html';
        }

        window.deleteItem = async function (itemId) {
            const confDelete = window.confirm("Are you sure you want to delete this item?")
            if (confDelete) {
                try {

                    //get quiz items
                    const quizItemsSnapshot = await get(ref(db, `user/${username}/quizzes/${currentQuizId}/quizItems`));

                    if (quizItemsSnapshot.exists()) {
                        const quizItems = quizItemsSnapshot.val();
                        const currentLength = Object.keys(quizItems).length; //get the length

                        // Check if the current number of items is 9
                        if (currentLength === 9) {
                            alert("A quiz must have at least 9 items. You cannot delete this item.");
                            return; // Prevent deletion
                        }
                        else {
                            //allow delete
                            const itemRef = ref(db, `user/${username}/quizzes/${currentQuizId}/quizItems/${itemId}`);
                            await remove(itemRef);
                            console.log(`Item ${itemId} deleted successfully`);

                            //update maxscore
                            const UpdatedquizItemsSnapshot = await get(ref(db, `user/${username}/quizzes/${currentQuizId}/quizItems`));
                            let updatedMaxScore = 0;

                            if (UpdatedquizItemsSnapshot.exists()) {
                                updatedMaxScore = Object.keys(UpdatedquizItemsSnapshot.val()).length;
                            }

                            // Update the maxScore in the quiz node
                            const quizRef = ref(db, `user/${username}/quizzes/${currentQuizId}`);
                            await update(quizRef, { maxscore: updatedMaxScore });

                        }
                    }
                    alert('Item deleted successfully!');
                    showItems(currentQuizId)
                    getUserQuizzes()
                } catch (error) {
                    console.error('Error deleting item:', error);
                    alert('Failed to delete item. Please try again.');
                }

            }
        }

        window.deleteQuiz = async function (quiz_id) {
            const confDelete = window.confirm("Are you sure you want to delete this quiz?")
            if (confDelete) {
                try {
                    const quizref = ref(db, `user/${username}/quizzes/${quiz_id}`);
                    await remove(quizref);
                    alert('Quiz deleted successfully!');
                    location.reload()
                } catch (error) {
                    console.error('Error deleting quiz:', error);
                    alert('Failed to delete quiz. Please try again.');
                }
            }
        }

        window.editQuiz = function (quiz_id) {
            currentQuizId = quiz_id
            const quizRef = ref(db, `user/${username}/quizzes/${quiz_id}`);
            get(quizRef).then((snapshot) => {
                if (snapshot.exists()) {
                    const quizData = snapshot.val();
                    document.getElementById('edit-title').value = quizData.title;
                    document.getElementById('edit-description').value = quizData.description;
                    document.getElementById('edit-quiz-modal').style.display = 'block';
                } else {
                    console.log('No quiz data found');
                }
            }).catch((error) => {
                console.error('Error fetching quiz data:', error);
            });
        }

        window.closeEditQuiz = function () {
            document.getElementById('edit-quiz-modal').style.display = 'none';
        }

        window.saveQuizUpdate = async function () {
            var title = document.getElementById('edit-title').value
            var description = document.getElementById('edit-description').value

            if (!title) {
                alert("Please add a title.")
                return;
            }

            try {
                const quizRef = ref(db, `user/${username}/quizzes/${currentQuizId}`);
                await update(quizRef, {
                    title: title,
                    description: description
                });
                alert('Quiz updated successfully!');
                closeEditQuiz();
                getUserQuizzes();

            } catch (error) {
                console.error('Error updating quiz:', error);
                alert('Failed to update quiz. Please try again.');
            }
        }

        window.editItem = function (itemId, itemType) {
            currentItemId = itemId
            currentItemType = itemType

            const itemRef = ref(db, `user/${username}/quizzes/${currentQuizId}/quizItems/${itemId}`);
            get(itemRef).then((snapshot) => {
                if (snapshot.exists()) {
                    const itemData = snapshot.val();

                    if (itemType == "identification") {

                        document.getElementById('edit-quiz-question').value = itemData.question
                        document.getElementById('edit-quiz-answer').value = itemData.answer
                        closeItems()
                        document.getElementById('edit-quiz').style.display = 'block'
                        document.getElementById('edit-quiz-identification').style.display = 'block'
                    }
                    else if (itemType == "multchoice") {
                        document.getElementById('edit-quiz-question').value = itemData.question
                        document.getElementById('edit-quiz-wrong-option1').value = itemData.wrong1
                        document.getElementById('edit-quiz-wrong-option2').value = itemData.wrong2
                        document.getElementById('edit-quiz-correct-option').value = itemData.correct

                        closeItems()
                        document.getElementById('edit-quiz').style.display = 'block'
                        document.getElementById('edit-quiz-MultChoice').style.display = 'block'
                    }
                    else {
                        document.getElementById('edit-quiz-question').value = itemData.question
                        if (itemData.truefalse === 'True') {
                            document.getElementById('edit-quiz-true').checked = true;
                            document.getElementById('edit-quiz-false').checked = false;
                        } else {
                            document.getElementById('edit-quiz-false').checked = true;
                            document.getElementById('edit-quiz-true').checked = false;
                        }

                        closeItems()
                        document.getElementById('edit-quiz').style.display = 'block'
                        document.getElementById('edit-quiz-TrueFalse').style.display = 'block'
                    }

                } else {
                    console.log('No quiz data found');
                }
            }).catch((error) => {
                console.error('Error fetching quiz data:', error);
            });
        }

        window.closeEditItem = function () {
            closeAllEditItem()
            showItems(currentQuizId)
        }

        window.closeAllEditItem = function () {
            document.getElementById('edit-quiz').style.display = 'none'
            document.getElementById('edit-quiz-TrueFalse').style.display = 'none'
            document.getElementById('edit-quiz-MultChoice').style.display = 'none'
            document.getElementById('edit-quiz-identification').style.display = 'none'
        }

        window.saveItemEdit = async function () {
            console.log(`type: ${currentItemType}`)
            const quizRef = ref(db, `user/${username}/quizzes/${currentQuizId}/quizItems/${currentItemId}`);
            if (currentItemType == 'identification') {
                var question = document.getElementById('edit-quiz-question').value
                var answer = document.getElementById('edit-quiz-answer').value

                if (!question || !answer) {
                    alert("Fields should not be left empty.")
                    return
                }

                try {
                    await update(quizRef, {
                        question: question,
                        answer: answer
                    });
                    alert('Item updated successfully!');
                    closeEditItem()

                } catch (error) {
                    console.error('Error updating quiz:', error);
                    alert('Failed to update quiz. Please try again.');
                }

            } else if (currentItemType == 'multchoice') {
                var question = document.getElementById('edit-quiz-question').value
                var wrong1 = document.getElementById('edit-quiz-wrong-option1').value
                var wrong2 = document.getElementById('edit-quiz-wrong-option2').value
                var correct = document.getElementById('edit-quiz-correct-option').value

                if (!question || !wrong1 || !wrong2 || !correct) {
                    alert("Fields should not be left empty.")
                    return
                }

                try {
                    await update(quizRef, {
                        question: question,
                        wrong1: wrong1,
                        wrong2: wrong2,
                        correct: correct
                    });
                    alert('Item updated successfully!');
                    closeEditItem()

                } catch (error) {
                    console.error('Error updating quiz:', error);
                    alert('Failed to update quiz. Please try again.');
                }

            } else {
                var question = document.getElementById('edit-quiz-question').value
                var truefalse = document.querySelector('input[name="edit-quiz-truefalse"]:checked').value;

                if (!question) {
                    alert("Fields should not be left empty.")
                    return;
                }

                try {
                    await update(quizRef, {
                        question: question,
                        truefalse: truefalse
                    });

                    alert('Item updated successfully!');
                    closeEditItem()

                } catch (error) {
                    console.error('Error updating quiz:', error);
                    alert('Failed to update quiz. Please try again.');
                }

            }
        }
        let backtozero = 0;


        window.playGame = function (quiz_id, bestscore) {
            sessionStorage.setItem('quiz_id', quiz_id)
            sessionStorage.setItem('bestscore', bestscore)
            // sessionStorage.setItem("score2", backtozero)
            // sessionStorage.setItem("score3", backtozero)
            // sessionStorage.setItem("score", backtozero)
            // sessionStorage.setItem("currentScore", backtozero)
            // alert(currentScore +"  "+ score2 +"  " + score3)
            // console.log(score2)
            // console.log(score3)

            window.location.href = 'game.html'

        }

        window.openGameMechanics = function () {
            window.location.href = "map.html"
        }
    </script>
</body>

</html>